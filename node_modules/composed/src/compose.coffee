isFunction = (f) -> typeof f is 'function'

module.exports = (middlewares...) ->
    bind = (fst, snd) ->
        throw new Error "fst is not a function #{fst}" unless isFunction fst
        throw new Error "snd is not a function #{snd}" unless isFunction snd
        (req, res, next) -> fst req, res, -> snd req, res, next
    nop = (req, res, next) -> next()
    middlewares.reduce ((state, current) -> bind state, current), nop
